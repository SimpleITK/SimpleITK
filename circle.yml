machine:
    environment:
        SIMPLEITK_SRC_DIR: ${HOME}/SimpleITK
        SIMPLEITK_BUILD_DIR: ${SIMPLEITK_SRC_DIR}/bld
        ExternalData_OBJECT_STORES: ${HOME}/.ExternalData
        CMAKE_DOWNLOAD_FILE: cmake-3.6.0-Linux-x86_64.sh
        ITK_REPOSITORY: ${ExternalData_OBJECT_STORES}/ITK.git
        MAKE_J: $(expr $CIRCLE_NODE_TOTAL \* 2 + 1)
    post:
        - sudo apt-get remove cmake && sudo apt-get install swig libinsighttoolkit4-dev doxygen
        - mkdir -p "${ExternalData_OBJECT_STORES}"
        - cd ${ExternalData_OBJECT_STORES} && if [[ ! -e ${CMAKE_DOWNLOAD_FILE} ]]; then curl -sSO https://cmake.org/files/v3.6/${CMAKE_DOWNLOAD_FILE}; fi
        - echo "y\n" | sudo bash "${ExternalData_OBJECT_STORES}/${CMAKE_DOWNLOAD_FILE}" --prefix=/usr/local --exclude-subdir

dependencies:
    cache_directories:
        - "~/.ExternalData"
    pre:
        - mkdir -p ${SIMPLEITK_BUILD_DIR}
    override:
        - sed -iBAK -e "s/ITKImageNoise/#ITKImageNoise/" ${SIMPLEITK_SRC_DIR}/CMake/sitkCheckForITKModuleDependencies.cmake ${SIMPLEITK_SRC_DIR}/Code/BasicFilters/src/CMakeLists.txt
        - cmake -DWRAP_LUA:BOOL=OFF -DWRAP_PYTHON:BOOL=OFF -DWRAP_JAVA:BOOL=OFF -DWRAP_CSHARP:BOOL=OFF -DWRAP_TCL:BOOL=OFF -DWRAP_R:BOOL=OFF -DWRAP_RUBY:BOOL=OFF -DBUILD_EXAMPLES:BOOL=OFF -DBUILD_TESTING:BOOL=OFF -DBUILD_DOXYGEN:BOOL=ON -DCMAKE_BUILD_TYPE=Release "${SIMPLEITK_SRC_DIR}":
            pwd: bld
        - make Documentation:
            pwd: bld



test:
    override:
        - ls bld/Documentation/html
        - mv bld/Documentation $CIRCLE_ARTIFACTS
