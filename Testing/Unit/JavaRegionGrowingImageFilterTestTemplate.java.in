package org.itk.simple.testing;

// This is Java code to test ${name}
import org.itk.simple.*;

class ${name}ImageFilterTest {

  public static void main( String argv[] ) {

    // Get the right number of inputs
    int inputs = 1;
    $(if number_of_inputs then
        OUT=[[inputs = ${number_of_inputs};]]
      end)

    // Check the command line arguments
    if ( argv.length < inputs + 1 ) {
      System.out.println("Usage: ${name} tag <input(s)> output");
      return;
    }

    String tag = argv[0];

    // Instantiate objects
    ImageFileReader reader = new ImageFileReader();
    ImageFileWriter writer = new ImageFileWriter();
    ${name}ImageFilter filter = new ${name}ImageFilter();

    $(if #tests == 0 then
    OUT=[[
    // No tests defined => exit with error code
    System.out.println ( "No tests defined!" );
    System.exit ( 1 );
    ]]
    end)

    // Run each test
$(foreach tests
    if (tag.equals( "${tag}" )) {
      $(when settings 
      // Set parameters
      $(foreach settings
$(if parameter == "SeedList" then
      OUT=[[filter.clearSeeds();
      filter$(for i=1,#value do OUT=OUT .. ".addSeed( new Index" .. value[i] .. " )" end);]]
else
OUT=[[
      filter.set${parameter}( $(if java_value then OUT='${java_value}' else OUT='${value}' end) );]]
end) 
)
)

      // Read image(s) and run the filter
      SmartPointerImage inputA = reader.setFilename( argv[1] ).execute();
$(if inputB then
      OUT=[[
      SmartPointerImage inputB = reader.setFilename ( argv[2] ).execute();
      SmartPointerImage output = filter.execute ( inputA, inputB );]]
else
      OUT=[[
      SmartPointerImage output = filter.execute ( inputA );]]
end)

      // Write output
      writer.setFilename( argv[argv.length - 1] ).execute( output );
    }
)

  }
}
