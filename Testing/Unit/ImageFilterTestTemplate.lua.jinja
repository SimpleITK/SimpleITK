--==========================================================================
--
--   Copyright NumFOCUS
--
--   Licensed under the Apache License, Version 2.0 (the "License");
--   you may not use this file except in compliance with the License.
--   You may obtain a copy of the License at
--
--          http://www.apache.org/licenses/LICENSE-2.0.txt
--
--   Unless required by applicable law or agreed to in writing, software
--   distributed under the License is distributed on an "AS IS" BASIS,
--   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
--   See the License for the specific language governing permissions and
--   limitations under the License.
--
--==========================================================================*/

-- WARNING: DO NOT EDIT THIS FILE!
-- THIS FILE IS AUTOMATICALLY GENERATED BY THE SIMPLEITK BUILD PROCESS.

-- This is Lua code to test {{ name }}
require "SimpleITK"

local unpack = unpack or table.unpack

inputs = {{ number_of_inputs | default(1) }}

if #arg < inputs + 2 then
  print("Usage: {{ name }} tag <input(s)> output")
  os.exit(1)
end

tag = arg[1]

reader = SimpleITK.ImageFileReader()
writer = SimpleITK.ImageFileWriter()
filter = SimpleITK.{{ name }}()

{% for test in tests %}
if tag == "{{ test.tag }}" then
  {% for setting in test.settings %}
  {% if setting.parameter == "SeedList" and setting.lua_value %}
  filter:ClearSeeds()
  {% for value in setting.lua_value %}
  filter:AddSeed({{ value }})
  {% endfor %}
  {% elseif setting.lua_value %}
  filter:Set{{ setting.parameter }}({{ setting.lua_value }})
  {% else %}
  filter:Set{{ setting.parameter }}({{ setting.value }})
  {% endif %}
  {% endfor %}

  inputs = {}
  for i = 2, #arg - 1 do
    print("reading..." .. arg[i])
    reader:SetFileName(arg[i])
    table.insert(inputs, reader:Execute())
  end

  output = filter:Execute(unpack(inputs))
  writer:UseCompressionOn()
  writer:SetFileName(arg[#arg])
  writer:Execute(output)
end
{% endfor %}
