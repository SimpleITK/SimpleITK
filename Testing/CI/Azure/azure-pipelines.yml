# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - master
  - next
  - release
variables:
  ExternalDataVersion: 1.2.0
jobs:

  - job: VS
    timeoutInMinutes: 0
    cancelTimeoutInMinutes: 300
    strategy:
      maxParallel: 2
      matrix:
        VS14:
          imageName: 'vs2017-win2016'
          CTEST_CMAKE_GENERATOR: 'Visual Studio 14 2015'
          CMAKE_GENERATOR_PLATFORM: x64
    pool:
      vmImage: $(imageName)
    steps:
      - template: templates/git-download-steps.yml
      - script: |
          cmake --version
          find "C:\Program Files (x86)\Microsoft Visual Studio\2017"  -name vcvars64.bat
          dir "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC"
          ctest -S "$(Build.SourcesDirectory)/Testing/CI/Azure/azure.cmake" -VV
        displayName: Build and test
        workingDirectory: $(Agent.BuildDirectory)
        env:
          CTEST_CONFIGURATION_TYPE: MinSizeRel
          DASHBOARD_BRANCH_DIRECTORY: $(Agent.BuildDirectory)/SimpleITK-dashboard
          ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS: 2
          CXXFLAGS: /MP
          CFLAGS: /MP
